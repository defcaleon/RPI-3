const body=document.querySelector("body"),lang=document.getElementById("lang"),city=document.getElementById("city"),country=document.getElementById("country"),time=document.getElementById("time"),date=document.getElementById("date"),tempF=document.getElementById("temp-f"),tempC=document.getElementById("temp-c"),humidityText=document.querySelector(".humidity-text"),summaryText=document.querySelector(".summary"),apparentText=document.querySelector(".apparent-text"),windText=document.querySelector(".wind-text"),windUnitsText=document.querySelector(".wind-units"),latitudeText=document.querySelector(".latitude-text"),longitudeText=document.querySelector(".longitude-text"),searchBtn=document.getElementById("search"),reloadBtn=document.getElementById("reload"),searchInput=document.querySelector(".search-input"),weatherIcon=document.getElementById("weather-icon-main"),apparentValue=document.querySelector(".apparent-value"),windValue=document.querySelector(".wind-value "),humidityValue=document.querySelector(".humidity-value"),temperature=document.querySelector(".current-temperature"),longitudeValue=document.querySelector(".longitude-value"),latitudeValue=document.querySelector(".latitude-value"),day1Num=document.getElementById("num-day-one"),day1Temp=document.getElementById("temp-day-one"),day1Ico=document.getElementById("ico-day-one"),day2Num=document.getElementById("num-day-two"),day2Temp=document.getElementById("temp-day-two"),day2Ico=document.getElementById("ico-day-two"),day3Num=document.getElementById("num-day-three"),day3Temp=document.getElementById("temp-day-three"),day3Ico=document.getElementById("ico-day-three"),voiceBtn=document.querySelector(".voice"),arr_week_en=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],arr_month_en=["January","February","March","April","May","June","July","August","September","October","November","December"],arr_week_ru=["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],arr_month_ru=["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"],arr_week_en_full=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],arr_week_ru_full=["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"];let arr_week,arr_month,temperatureCond,arr_week_full,numDayVar,voice=null,voiceFlag=!1;function keyInputEnter(e){"keypress"===e.type&&13===e.keyCode&&(getWeatherAndMap().then(e=>getCity()),searchInput.value="")}function startSelect(){"ru"===localStorage.getItem("lang")&&(lang.options[1].selected=!0)}function numDay(){let e=(new Date).getDay();numDayVar=e}function getTemperatureCond(){null==localStorage.getItem("temp")?(localStorage.setItem("temp","1"),temperatureCond=!0,tempC.classList.add("temp-btn-active")):(temperatureCond=Boolean(Number(localStorage.getItem("temp"))))?tempC.classList.add("temp-btn-active"):tempF.classList.add("temp-btn-active")}function getCorrectTemperature(e){return temperatureCond?parseInt(e,10):parseInt(1.8*parseInt(e,10)+32)}function makeAllFarenheit(){temperatureCond&&(makeFarenheit(temperature),makeFarenheit(apparentValue),makeFarenheit(day1Temp),makeFarenheit(day2Temp),makeFarenheit(day3Temp),temperatureCond=!temperatureCond)}function makeAllCelsium(){temperatureCond||(makeCelsium(temperature),makeCelsium(apparentValue),makeCelsium(day1Temp),makeCelsium(day2Temp),makeCelsium(day3Temp),temperatureCond=!temperatureCond)}function makeFarenheit(e){e.textContent=parseInt(1.8*parseInt(e.textContent,10)+32)}function makeCelsium(e){e.textContent=parseInt((parseInt(e.textContent,10)-32)/1.8)}function langChange(){localStorage.setItem("lang",lang.value),currLang()}function engLang(){humidityText.textContent="humidity: ",summaryText.textContent="overcast: ",apparentText.textContent="feels like: ",windText.textContent="wind: ",windUnitsText.textContent="m/s ",searchBtn.textContent="search",searchInput.placeholder="city name",longitudeText.textContent="longitude :",latitudeText.textContent="latitude :",numberDayInTextField(numDayVar+1,day1Num),numberDayInTextField(numDayVar+2,day2Num),numberDayInTextField(numDayVar+3,day3Num)}function ruLang(){humidityText.textContent="влажность: ",summaryText.textContent="прогноз: ",apparentText.textContent="чувствуется: ",windText.textContent="ветер: ",windUnitsText.textContent="м/с ",searchBtn.textContent="поиск",searchInput.placeholder="название города",longitudeText.textContent="долгота :",latitudeText.textContent="широта :",numberDayInTextField(numDayVar+1,day1Num),numberDayInTextField(numDayVar+2,day2Num),numberDayInTextField(numDayVar+3,day3Num)}function currLang(){switch(null==localStorage.getItem("lang")&&localStorage.setItem("lang","ru"),localStorage.getItem("lang")){case"en":arr_week_full=arr_week_en_full,engLang(),arr_week=arr_week_en,arr_month=arr_month_en;break;case"ru":arr_week_full=arr_week_ru_full,ruLang(),arr_week=arr_week_ru,arr_month=arr_month_ru;break;default:engLang()}voiceChangeLang()}async function getCity(){null===localStorage.getItem("city")||null===localStorage.getItem("country")?await getGeolocation():(city.textContent=localStorage.getItem("city"),country.textContent=localStorage.getItem("country")),console.log("getcity"),console.log(localStorage.getItem("city"))}function showTime(){let e=new Date,t=e.getHours(),n=e.getMinutes(),a=e.getSeconds(),o=e.getDay(),r=e.getDate(),c=e.getMonth();time.innerHTML=`${t}<span>:</span>${addZero(n)}<span>:</span>${addZero(a)}`,date.innerHTML=`${arr_week[o]}<span>, </span>${r} ${arr_month[c]}`,setTimeout(showTime,1e3)}function addZero(e){return(parseInt(e,10)<10?"0":"")+e}async function getLinkToImage(){const e=await fetch("https://api.unsplash.com/photos/random?query=night&orientation=landscape&client_id=wMR3Adq52thNgDI8TO8Poc7uIVuq1RkPC6BcCCgrANE");if(!e.ok)return body.style.backgroundImage="url(images/def_back.jpg)",void console.log("defBack");const t=await e.json();body.style.backgroundImage=`url(${t.urls.regular})`}async function getGeolocation(){const e=await fetch("https://ipinfo.io/json?token=9f4339bb6b6de0");if(e.ok){const t=await e.json();city.textContent=t.city,country.textContent=t.country,localStorage.setItem("city",city.textContent),localStorage.setItem("country",country.textContent)}else console.log("error in res")}async function getWeatherAndMap(){console.log("getwather"),console.log(localStorage.getItem("city"));let e=""!==searchInput.value?searchInput.value:localStorage.getItem("city"),t=`https://api.openweathermap.org/data/2.5/weather?q=${e}&lang=en&appid=32668db5559e877281a139dd47d93fee&units=metric`;const n=await fetch(t);if(!n.ok)return;const a=await n.json();weatherIcon.className="weather-icon owf",weatherIcon.classList.add(`owf-${a.weather[0].id}`),temperature.textContent=getCorrectTemperature(a.main.temp),apparentValue.textContent=getCorrectTemperature(a.main.feels_like),windValue.textContent=a.wind.speed,humidityValue.textContent=a.main.humidity,latitudeValue.textContent=a.coord.lat,longitudeValue.textContent=a.coord.lon,await getMap(),localStorage.setItem("city",e),localStorage.setItem("country",a.sys.country),await getWeather3days()}async function reloadBackImg(){await getLinkToImage(),setInterval(getLinkToImage,36e5)}async function getMap(){mapboxgl.accessToken="pk.eyJ1IjoiZGVmY2FsZW9uIiwiYSI6ImNrcDVrYmxieDAyamcyb29mbnN1eXd4ZmoifQ.GqTyuw1zzaXNq7Kl8MDX1Q";let e=parseFloat(longitudeValue.textContent),t=parseFloat(latitudeValue.textContent);new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[e,t],zoom:10})}async function getWeather3days(){let e=`https://api.openweathermap.org/data/2.5/forecast?q=${localStorage.getItem("city")}&lang=ru&units=metric&APPID=32668db5559e877281a139dd47d93fee`;const t=await fetch(e);if(!t.ok)return;const n=await t.json();weather1day(n,7,day1Ico,day1Temp),numberDayInTextField(numDayVar+1,day1Num),weather1day(n,14,day2Ico,day2Temp),numberDayInTextField(numDayVar+2,day2Num),weather1day(n,21,day3Ico,day3Temp),numberDayInTextField(numDayVar+3,day3Num)}function weather1day(e,t,n,a){n.className="weather-icon-mini owf",n.classList.add(`owf-${e.list[t].weather[0].id}`),a.textContent=getCorrectTemperature(e.list[t].main.temp)}function numberDayInTextField(e,t){for(;e>6;)e-=7;t.textContent=arr_week_full[e]}function voiceIsSupported(){return!!(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition)}function voiceObCreate(){if(voiceIsSupported())return new(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition)}function voiceChangeLang(){null!=voice&&(voice.stop(),voiceFlag=!1,voiceSetLang())}function voiceFunc(){voice.interimResults=!0,voice.onresult=function(e){var t=e.results[e.resultIndex];t.isFinal?(getWeatherAndMap().then(e=>getCity()),voice.stop(),voiceFlag=!1,searchInput.value=""):searchInput.value=t[0].transcript}}function voiceSetLang(){null!=voice&&("ru"===localStorage.getItem("lang")?voice.lang="ru-RU":voice.lang="en-EN")}numDay(),getCity().then(e=>getWeatherAndMap()),currLang(),showTime(),getTemperatureCond(),startSelect(),reloadBackImg(),voiceBtn.addEventListener("click",()=>{null==voice&&(voice=voiceObCreate(),voiceSetLang(),voiceFunc()),voiceFlag?(voice.stop(),console.log("Voice stopped")):(voice.start(),console.log("Voice started")),voiceFlag=!voiceFlag}),tempF.addEventListener("click",()=>{tempF.classList.add("temp-btn-active"),tempC.classList.remove("temp-btn-active"),localStorage.setItem("temp","0"),makeAllFarenheit()}),tempC.addEventListener("click",()=>{tempC.classList.add("temp-btn-active"),tempF.classList.remove("temp-btn-active"),makeAllCelsium(),localStorage.setItem("temp","1")}),reloadBtn.addEventListener("click",()=>{getLinkToImage()}),searchBtn.addEventListener("click",()=>{getWeatherAndMap().then(e=>getCity()),searchInput.value=""}),searchInput.addEventListener("keypress",keyInputEnter),lang.addEventListener("change",()=>{langChange()});